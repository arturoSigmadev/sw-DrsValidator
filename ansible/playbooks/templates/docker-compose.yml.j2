version: '3.8'

services:
  {{ docker_container_name }}:
    image: {{ docker_image_name }}:{{ docker_image_tag }}
    container_name: {{ docker_container_name }}
    ports:
      - "{{ app_port }}:8080"
    volumes:
      - {{ logs_dir }}:/app/logs
      - {{ data_dir }}:/app/data
      - {{ config_dir }}:/app/config
    environment:
      - PYTHONPATH=/app
      - ENVIRONMENT={{ app_environment }}
      - LOG_LEVEL=INFO
      - DRS_PORT=8080
      - DRS_HOST=0.0.0.0
    env_file:
      - .env
    restart: unless-stopped
    deploy:
      resources:
        limits:
          memory: {{ resource_limits.memory }}
          cpus: '{{ resource_limits.cpu }}'
        reservations:
          memory: 128m
          cpus: '0.25'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 90s
    networks:
      - drs-network

networks:
  drs-network:
    driver: bridge
    driver_opts:
      com.docker.network.driver.mtu: 1500